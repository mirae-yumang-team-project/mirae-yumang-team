<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>게시판</title>
    <link rel="stylesheet" href="/static/css/reset.css">
    <link rel="stylesheet" href="/static/css/post-list.css">
</head>
<body>
<div class="navbar">
    <a href="/home" class="navbar-brand">STARLOG</a>
    <div class="navbar-menu">
        <a href="/posts">게시판</a>
        <a th:if="${username}" href="/mypage" th:text="${username} + '님'"></a>
        <a th:if="${username}" href="/auth/logout">로그아웃</a>
        <a th:unless="${username}" href="/auth/login">로그인</a>
    </div>
</div>

<div class="container">
    
        <div class="community-header">
            <img src="/static/images/STARLOG (3).png" alt="">
            <div class="titlebox">
                <h1>학교 커뮤니티</h1>
                <span>학생들의 작은 이야기들이 모이는 곳</span>
                <form class="search-box">
                    <input type="search" placeholder="게시글 검색" />
                    <button type="submit">검색</button>
                </form>
            </div>
        </div>




    <div class="page-header">
        <div>
            <div class="post-count">총 <span th:text="${posts.size()}" class="post-count-v"></span>개의 게시글</div>
        </div>

        <div class="post-main">

        
        

    <div class="post-table">
        <!-- 게시글 목록 테이블 -->
        <table th:if="${posts.size() > 0}">
            <thead>
                <tr>
                    <th class="col-id">번호</th>
                    <th class="col-title">제목</th>
                    <th class="col-author">작성자</th>
                    <th class="col-date">날짜</th>
                    <th class="col-views">조회수</th>
                    <th class="col-likes">추천</th> </tr>
            </thead>
            <tbody>
                <tr th:each="post, iterStat : ${posts}" th:onclick="|location.href='@{/posts/{id}(id=${post.id})}'|" style="cursor:pointer;">
                    <td class="col-id" th:text="${iterStat.count}"></td>
                    <td class="col-title">
                        <a th:href="@{/posts/{id}(id=${post.id})}"
                        th:text="${post.title}"
                        class="post-title"></a>
                    </td>
                    <td class="col-author" th:text="${post.author}"></td>
                    <td class="col-date" th:text="${#temporals.format(post.createdAt, 'yyyy-MM-dd HH:mm')}"></td>
                    <td class="col-views" th:text="${post.viewCount} ?: 0"></td>
                    <td class="col-likes" th:text="${post.likeCount} ?: 0"></td> 
                </tr>
            </tbody>
        </table>

        <!-- 게시글이 없을 때 -->
        <div class="empty-message" th:unless="${posts.size() > 0}">
            아직 게시글이 없습니다.
        </div>
        
        </div>
        <div class="bastpost-main">

        <a th:if="${username}" href="/posts/write" class="btn">글쓰기</a>
        <a th:unless="${username}" href="/auth/login" class="btn">로그인 후 글쓰기</a>

        <div class="bastpost">
            <div class="tmp">
                <h3 class="best-title">인기 게시글 </h3>
                <span class="title-sub">(추천수)</span>
            </div>
            <ul class="best-list">
                <li class="best-item" th:each="post : ${bestPosts}">
                    <a th:href="@{/posts/{id}(id=${post.id})}" class="best-link">
                        <div class="best-text">
                            <span class="best-nickname" th:text="${post.user.username}">user1</span>
                            <p class="best-content" th:text="${post.title}">인기 게시글 제목</p>
                        </div>
                        <span class="best-likes" th:text="${post.likeCount} ?: 0">0</span>
                    </a>
                </li>
                
                <li class="best-item" th:if="${#lists.isEmpty(bestPosts)}">
                    <p class="best-content" style="text-align: center; color: #9DB2F5;">인기 게시글이 없습니다.</p>
                </li>
            </ul>
        </div>
            </div>
        </div>
        </div>
    </div>
</div>
                <div class="pagination">
                    <button class="page-btn" data-page="prev">이전</button>
                    <span class="page-info">1 / 1</span>
                    <button class="page-btn" data-page="next">다음</button>
                </div>
</body>
    <script>
         const postsPerPage = 11; // 한 페이지 최대 6개
    let currentPage = 1;

    const allPosts = Array.from(document.querySelectorAll('.post-table tbody tr'));
    const totalPages = Math.ceil(allPosts.length / postsPerPage);
    const pageInfo = document.querySelector('.page-info');

    function showPage(page) {
      currentPage = page;
      allPosts.forEach((post, index) => {
        const start = (currentPage - 1) * postsPerPage;
        const end = currentPage * postsPerPage;
        post.style.display = (index >= start && index < end) ? 'block' : 'none';
      });
      pageInfo.textContent = `${currentPage} / ${totalPages}`;
    }

    // 초기 화면
    showPage(1);

    // 버튼 이벤트
    document.querySelectorAll('.page-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        if(btn.dataset.page === 'prev' && currentPage > 1){
          showPage(currentPage - 1);
        } else if(btn.dataset.page === 'next' && currentPage < totalPages){
          showPage(currentPage + 1);
        }
      });
    });
    function openModal() {
    const modal = document.getElementById('postModal');
    if (modal) {
        modal.style.display = 'flex';
        document.body.style.overflow = 'hidden';
    }
}
    </script>
</html>